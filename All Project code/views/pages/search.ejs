<%- include ('../partials/head') %>
<%- include ('../partials/menu') %>

<main>
    <script src="script.js"></script>
    <div class="container">
        <% if (search && search.length > 0) { %>
            <h1>Search Results</h1>
            <div class="col"></div>
            <table class="table">
                <thead>
                    <tr>
                        <th style="width: 18%">Name</th>
                        <th style="width: 18%">Image</th>
                        <th style="width: 18%">Reviews</th>
                        <th style="width: 18%">Address</th>
                        <th style="width: 18%">Average Rating</th>
                        <% if(user){ %>
                            <th style="width: 10%">Wishlist</th>
                        <% } %>
                    </tr>
                </thead>
                <tbody>
                    <% for (let i = 0; i < search.length; i++) { %>
                        <tr>
                            <td>
                                <%= search[i].name %>
                            </td>
                            <td> 
                                <img src=<%=search[i].image_url %> width=150> 
                            </td>

                            <% let link='/reviews/' + search[i].alias %>

                            <td> 
                                <a href=<%=link %>> <button class="btn btn-info" 
                                    type="button">See Reviews for <%= search[i].name %></button></a>
                            </td>
                            <td>
                                <a href="https://www.google.com/maps/place/<%= search[i].location.address1 %>, <%= search[i].location.city %>, <%= search[i].location.state %> <%= search[i].location.zip_code %>"><%= search[i].location.address1 %>, <%= search[i].location.city %>, <%= search[i].location.state %> <%= search[i].location.zip_code %></a>
                            </td>
                            <td>
                                <% yellow = Math.round(search[i].rating) %>
                                <% gray = 5 - yellow %>
                                <% for(j = 0; j < yellow; j++) { %>
                                    <img src="https://png.pngtree.com/png-clipart/20220926/original/pngtree-shiny-gold-star-clipart-illustration-design-png-image_8633179.png" alt="Yellow Star" width="20" height="20">
                                <% } %>
                                <% if(gray > 0) { %>
                                    <% for(k = 0; k < gray; k++) { %>
                                        <img src="https://purepng.com/public/uploads/large/purepng.com-grey-starstargeometricallydecagonconcavestardomclipartblackgrey-1421526502793oblca.png" alt="Gray Star" width="20" height="20">
                                    <% } %>
                                <% } %>
                            </td>
                            <td>
                                <% if (user) { %>
                                    <% if (userWishlist.includes(encodeURIComponent(search[i].alias))) { %>
                                        <div class="toggle-button checked" restaurant-name="<%= encodeURIComponent(search[i].name) %>" restaurant-alias="<%= search[i].alias %>" onclick="toggleButton(event, '<%= user.username %>', '<%= location %>')">
                                            <span class="iconPlus" id="iconPlus" style="opacity: 0;">+</span>
                                            <span class="iconCheck" id="iconCheck" style="opacity: 1;">&#10003;</span>
                                        </div>
                                    <% } else { %>
                                        <div class="toggle-button" restaurant-name="<%= encodeURIComponent(search[i].name) %>" restaurant-alias="<%= search[i].alias %>" onclick="toggleButton(event, '<%= user.username %>', '<%= location %>')">
                                            <span class="iconPlus" id="iconPlus" style="opacity: 1;">+</span>
                                            <span class="iconCheck" id="iconCheck" style="opacity: 0;">&#10003;</span>
                                        </div>
                                    <% } %>  
                                <% } %>                  
                            </td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        <% } else { %>
            <h2 style="text-align: center; padding-top: 20%;">Hmmmm, nothing was found. Modify your search and try again.</h2>
        <% } %>
    </div>
</main>

<%- include ('../partials/footer') %>
